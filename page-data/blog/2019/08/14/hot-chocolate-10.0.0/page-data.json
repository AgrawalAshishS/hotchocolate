{"componentChunkName":"component---src-templates-blog-article-tsx","path":"/blog/2019/08/14/hot-chocolate-10.0.0","result":{"data":{"markdownRemark":{"html":"<p><img src=\"/img/blog/hotchocolate-banner.svg\" alt=\"Hot Chocolate\"></p>\n<p>Today we have released version 10 of <em>Hot Chocolate</em>. We originally started building version 9.1 which grew bigger and at one point became version 10. We have focused a lot on our server implementation. But let me walk you through our latest release.</p>\n<h2>Filters</h2>\n<p>So, while we focused a lot on the server implementation, we also added some nice features to the GraphQL core. The main feature we added here is the new filter API.</p>\n<p>Filters let you query your backend with a powerful query input type that translates into native database queries.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  persons<span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">where</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">OR</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token attr-name\">firstName_starts_with</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"abc\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">lastName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"def\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    firstName\n    lastName\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The above query would translate to a something like <code class=\"language-text\">persons.Where(t =&gt; t.FirstName.StartsWith(&quot;abc&quot;) || t.LastName == def)</code>.</p>\n<p>This works out of the box if you are using <code class=\"language-text\">IQueryable</code>.</p>\n<p>All you have to do in your schema type is to add a <code class=\"language-text\">UseFiltering</code> to your field descriptor.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QueryType</span>\n  <span class=\"token punctuation\">:</span> <span class=\"token class-name\">ObjectType</span><span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span>IObjetcTypeDescriptor<span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span> descriptor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token function\">Field</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span><span class=\"token function\">GetPersons</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span>Type<span class=\"token operator\">&lt;</span>ListType<span class=\"token operator\">&lt;</span>PersonType<span class=\"token operator\">>></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">UseFiltering</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Filters are easily combined with our pagination.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QueryType</span>\n  <span class=\"token punctuation\">:</span> <span class=\"token class-name\">ObjectType</span><span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span>IObjetcTypeDescriptor<span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span> descriptor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        descriptor<span class=\"token punctuation\">.</span><span class=\"token function\">Field</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span><span class=\"token function\">GetPersons</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">UsePaging</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PersonType</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">UseFiltering</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Also, it is possible to customize filters by describing what fields are filterable and what operators are allowed.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QueryType</span>\n  <span class=\"token punctuation\">:</span> <span class=\"token class-name\">ObjectType</span><span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span>IObjetcTypeDescriptor<span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span> descriptor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        descriptor\n          <span class=\"token punctuation\">.</span><span class=\"token function\">Field</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span><span class=\"token function\">GetPersons</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">UsePaging</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PersonType</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">UseFiltering</span><span class=\"token punctuation\">(</span>d <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span><span class=\"token function\">Ignore</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span>LastName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you want to use the same filter multiple times all over your schema you can also describe the filter input type separately.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PersonFilterType</span>\n    <span class=\"token punctuation\">:</span> <span class=\"token class-name\">FilterInputType</span><span class=\"token operator\">&lt;</span>Person<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span>\n        IFilterInputTypeDescriptor<span class=\"token operator\">&lt;</span>Foo<span class=\"token operator\">></span> descriptor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        descriptor\n            <span class=\"token punctuation\">.</span><span class=\"token function\">BindFieldsExplicitly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">Filter</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">BindOperationsExplicitly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">AllowEquals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"equals\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">And</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">AllowContains</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"contains\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">And</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">AllowIn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"in\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>And then use this filter type where you need it.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QueryType</span>\n  <span class=\"token punctuation\">:</span> <span class=\"token class-name\">ObjectType</span><span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Configure</span><span class=\"token punctuation\">(</span>IObjetcTypeDescriptor<span class=\"token operator\">&lt;</span>Query<span class=\"token operator\">></span> descriptor<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        descriptor\n          <span class=\"token punctuation\">.</span><span class=\"token function\">Field</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span><span class=\"token function\">GetPersons</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">UsePaging</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PersonType</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">UseFiltering</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PersonFilterType</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The nice thing here is that the filter works out of the box on <code class=\"language-text\">IQueryable</code> and <code class=\"language-text\">IEnumerable</code> so you can use it for database queries as well as for in-memory lists.</p>\n<p>With version 10 of <em>Hot Chocolate</em> we are supporting filters on scalar fields. But we are already working on support for object filters and enumerable filters.</p>\n<p>Also, we are working on sorting which should be included in the first preview of version 11.</p>\n<p>If you want to give input or follow our work, you can head over to these four issues that will be coming with version 11.</p>\n<ul>\n<li><a href=\"https://github.com/ChilliCream/hotchocolate/issues/921\">Object Filters #921</a></li>\n<li><a href=\"https://github.com/ChilliCream/hotchocolate/issues/922\">IEnumerable Filters #922</a></li>\n<li><a href=\"https://github.com/ChilliCream/hotchocolate/issues/923\">Sorting #923</a></li>\n<li><a href=\"https://github.com/ChilliCream/hotchocolate/issues/924\">Aggregations #924</a></li>\n</ul>\n<blockquote>\n<p>If you want to check out more about filters head over to our <a href=\"https://hotchocolate.io/docs/filters\">documentation</a>.</p>\n</blockquote>\n<p>Let me also thank <a href=\"https://github.com/PascalSenn\">Pascal</a> for his awesome work on this one.</p>\n<h2>Subscriptions</h2>\n<p>Subscriptions was another big investment that we took for this release.</p>\n<h3>Redis</h3>\n<p>For the core API we introduced a <em>Redis</em> subscription provider. This means that you now can use <em>Redis</em> as a pub/sub system without a hassle.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">var</span> configuration <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConfigurationOptions</span>\n<span class=\"token punctuation\">{</span>\n    Ssl <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n    AbortOnConnectFail <span class=\"token operator\">=</span> <span class=\"token keyword\">false</span><span class=\"token punctuation\">,</span>\n    Password <span class=\"token operator\">=</span> password\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nconfiguration<span class=\"token punctuation\">.</span>EndPoints<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"host:port\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nservices<span class=\"token punctuation\">.</span><span class=\"token function\">AddRedisSubscriptionProvider</span><span class=\"token punctuation\">(</span>configuration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>That`s all you have to do to connect the query engine with <code class=\"language-text\">Redis</code>.</p>\n<p><strong>So why should we want to use <code class=\"language-text\">Redis</code> anyway.</strong></p>\n<p>The thing with in-memory subscriptions is that they will only work reliable if you have one instance of <em>Hot Chocolate</em>. When you have deployed multiple instance of <em>Hot Chcocolate</em> or if you are scaling on demand with a massive amount of subscribers then you want to make sure that your pub/sub system scales and that mutations executed on one server raise an event on another one.</p>\n<p>But there is more, sometimes you want to raise an event without triggering a mutation, maybe there was an event somewhere in your infrastructure that you want to relay as a GraphQL subscription, this can also be done through an external pub/sub system like Redis.</p>\n<p>With version 11 We will add <em>Kafka</em> and <em>Azure EventHub</em> support and are also looking into other pub/sub systems, so that you can use whatever feels best to you.</p>\n<h3>Pipelines</h3>\n<p>We also rebuild the whole WebSocket handling in the server by using the new <code class=\"language-text\">Pipeline</code> API that Microsoft introduced to .Net. This makes it now super-efficient how we handle the messages with our new <code class=\"language-text\">UTF8RequestParser</code>. But we are not done here and will with version 11 further optimize our parser to work even better with pipelines.</p>\n<blockquote>\n<p>If you want to check out more about subscriptions head over to our <a href=\"https://hotchocolate.io/docs/code-first-subscription\">documentation</a>.</p>\n</blockquote>\n<p>Let me also thank <a href=\"https://github.com/glucaci\">Gabriel</a> for his great work on subscriptions.</p>\n<h2>Batching</h2>\n<p>Another big feature we have invested in was batching. When we started on this one we reflected a lot about how we want to do this and if we really need this one. In the end we decided that batching could enable great scenarios and is worth adding to our server.</p>\n<p>When Lee Byron initially showed batching off, he explained that this would be useful in cases where you want to fetch important data first and delay more expensive data without needing to issue two separate calls.</p>\n<p>They had this example that they want to fetch the news stream of a given user and the comments should appear once those are available.</p>\n<p><code class=\"language-text\">POST /graphql?batchOperations=[NewsFeed, StoryComments]</code></p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> NewsFeed <span class=\"token punctuation\">{</span>\n  stories <span class=\"token punctuation\">{</span>\n    id <span class=\"token directive function\">@export</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">as</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ids\"</span><span class=\"token punctuation\">)</span>\n    actor\n    message\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">query</span> StoryComments <span class=\"token punctuation\">{</span>\n  stories<span class=\"token punctuation\">(</span><span class=\"token attr-name\">ids</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$ids</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    comments<span class=\"token punctuation\">(</span><span class=\"token attr-name\">first</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      actor\n      message\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In the above query we would first fetch the stories, collect all the story ids and use these as an input to the next query to fetch all the comments for the former stories.</p>\n<p>The nice thing is that this is done in one HTTP call and as soon as query one is executed, we will write the result into the stream and the client can already work with that data while waiting for the second result.</p>\n<p>This all is working over one HTTP call without WebSockets and is super-efficient.</p>\n<p><strong>Why did we question its use?</strong></p>\n<p>The thing is that with version 11 we will introduce <code class=\"language-text\">@defer</code> which will allow you to do the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> NewsFeed <span class=\"token punctuation\">{</span>\n  stories <span class=\"token punctuation\">{</span>\n    id <span class=\"token directive function\">@export</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">as</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ids\"</span><span class=\"token punctuation\">)</span>\n    actor\n    message\n    <span class=\"token operator\">...</span> <span class=\"token directive function\">@defer</span> <span class=\"token punctuation\">{</span>\n      comments<span class=\"token punctuation\">(</span><span class=\"token attr-name\">first</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        actor\n        message\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The fragment that is annotated with <code class=\"language-text\">@defer</code> will be deferred to when it is ready. This means you can write queries much cleaner with this and reap the same benefits.</p>\n<p><strong>What makes batching a great feature then?</strong></p>\n<p>First, you can defer query parts with this now in version 10.</p>\n<p>Second, I think batching is very interesting with mutations where you can write complex mutation flows that use the results of one mutation to feed data in the next mutation. The ability to export result data into variables lets you write nice data flows.</p>\n<p>Look at how easy you can export data as variable by just adding <code class=\"language-text\">@export</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  foo <span class=\"token punctuation\">{</span>\n    bar <span class=\"token directive function\">@export</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>What`s important to know here is that you also can export objects that will convert to a matching input type.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  foo <span class=\"token directive function\">@export</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">as</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"something\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    bar\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Third, we also wanted to support Apollo batching where Apollo collects all the queries of a client in a certain time window and sends those in one request to our server. One batch will share the <em>DataLoader</em> instances which means that the batch request will be faster than sending them in separately.</p>\n<blockquote>\n<p>We are supporting operation batching and request batching and if you would like to know more about it head over to our <a href=\"https://hotchocolate.io/docs/batching\">documentation</a>.</p>\n</blockquote>\n<h2>Persisted Queries</h2>\n<p>With version 10 we now support persisted queries. With persisted queries you can add well-knonw queries to a second-level cache. All queries stored in there are considered valid.</p>\n<p><strong>So, what is this for?</strong></p>\n<p>Persisted queries are faster, since we validate those only once. Moreover, you do not need to send us the query every time, you can instead just send the query name and the server will look up the query and execute it. This can dramatically improves performance, reduces bandwidth and memory usage.</p>\n<p>This makes it feasible to use a simple <code class=\"language-text\">GET</code> request instead of a <code class=\"language-text\">POST</code> request which can also have benefits when using things like CDNs.</p>\n<p><code class=\"language-text\">GET http://example.com/graphql?namedQuery=QUERYNAME&amp;variables={&quot;id&quot;:&quot;QVBJcy5ndXJ1&quot;}</code></p>\n<p>We have opted to support both active persisted queries and persisted queries.</p>\n<blockquote>\n<p>Read more about this <a href=\"https://hotchocolate.io/docs/persisted-queries\">here</a>;</p>\n</blockquote>\n<h2>Server Modularization</h2>\n<p>With Version 10 we have now a modularized server implementation. That each middleware is placed in its own package. You can still just add our <code class=\"language-text\">HotChocolate.AspNetCore</code> or <code class=\"language-text\">HotChocolate.AspNetClassic</code> package and do not worry what is included in your server. But with version 10 you could now just add some of the middleware like maybe just HTTP-GET or HTTP-POST. This way if you do not use for instance subscriptions than there will not even be the code for subscriptions.</p>\n<p>With version 10 we have the following middleware available:</p>\n<ul>\n<li>HotChocolate.AspNetCore.HttpPost</li>\n<li>HotChocolate.AspNetCore.HttpGet</li>\n<li>HotChocolate.AspNetCore.HttpGetSchema</li>\n<li>HotChocolate.AspNetCore.Subscriptions</li>\n<li>HotChocolate.AspNetCore.Authorization</li>\n</ul>\n<blockquote>\n<p>Read more about this right <a href=\"https://hotchocolate.io/docs/aspnet\">here</a></p>\n</blockquote>\n<h2>UTF-8 Request Parser</h2>\n<p>With GraphQL most requests are provided as <code class=\"language-text\">JSON</code> that contains the request as an escaped string. This is kind of bad for performance since we first parse the <code class=\"language-text\">JSON</code> then take the string and parse again a string that we actually do not need.</p>\n<p>With the new <em>UTF-8 request parser</em> we can finally just read the binary request stream and parse the JSON and the GraphQL request in one go. But there is more, we have given our new UTF-8 request parser access to our document cache, meaning while we parse the JSON request and hit the part were the GraphQL request is, we can look up if this query is already cached. This dramatically reduces memory usage and performance since we will not consume the query property anyway.</p>\n<center>\n  <img src=\"../../../../img/request_parser_mem.png\" width=\"50%\">\n</center>\n<p>The new request parser does only allocate 1/3 of the memory that GraphQL-DotNet uses with it`s combination of JSON.Net and it`s string based GraphQL parser.</p>\n<p>The Hot Chocolate GraphQL parser is twice as fast than the GraphQL-DotNet parser on average. The whole request pipeline is 3 times faster on average, but we are not done yet and will double down on performance with the new query execution plans and our updated syntax tree that allows to further reduce string usage.</p>\n<h2>Everything Else</h2>\n<p>With version 10 we added a ton of bug fixes and also, we added a lot of API improvements that will make your day to day business so much easier.</p>\n<p>Like now you can add error filter to the dependency injection instead of registering them with the execution builder.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddErrorFilter</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyCustomErrorFilter</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The same goes for class <em>DataLoader</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddDataLoader</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyCustomDataLoader</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>When you use this extension, we also will add the <em>DataLoader</em> registry.</p>\n<p>Also, we refined things like the schema builder so that you can in place now define all the types:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\">SchemaBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">AddEnumType</span><span class=\"token punctuation\">(</span>d <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span><span class=\"token function\">Name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyEnum\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Value</span><span class=\"token punctuation\">(</span>\"FOO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>There are so many little things that can make your day :)</p>\n<h2>Version 11</h2>\n<p>Like with every release we are giving a little outlook for the next version. As the releases are fluid, we are sometimes moving things around.</p>\n<p>We want to really focus on two major topics with the next release.</p>\n<h2>Query Execution Plans</h2>\n<p>We originally planned for this one for version 10 (aka version 9.1) but decided that the current set of new features is already a good version that is worth to release. But with the next release this is one of the two things we really will focus on. With this in place we will double down on performance and will introduce features like <code class=\"language-text\">@defer</code> and <code class=\"language-text\">@stream</code>.</p>\n<p>Moreover, this one will be the backbone of our new stitching layer that will bring lots of new features to schema stitching.</p>\n<h2>Client API</h2>\n<p>The second thing we already started work on is a client API for .NET Core. We are currently experimenting with how we design this new piece of API. We have started a discussion around this in our slack channel and will start with some coding soon.</p>\n<h2>Banana Cakepop</h2>\n<p><strong>Oh, didn`t you forget something?</strong></p>\n<p>Yes, yes originally, we had planned to release <em>Banana Cakepop</em> alongside this version. We ran into some performance issues with the tree we originally selected when using large schemas with more than 1000 types.</p>\n<p>We have now started to write the tree component ourselves which is taking some extra time. We already see that we can handle now massive schemas far beyond 1000 types without any hiccups. But we have still lots to do on the new tree.</p>\n<p>I hope that we can see the promised preview in the next 4 to 8 weeks. We want to release something really good and not something half-backed.</p>\n<h2>The Other Things</h2>\n<p>We also will add more features to our filter API and make working with databases even easier.</p>\n<p>Also, we will add more subscription provider like Kafka and EventHub.</p>\n<p>Furthermore, we will rework our <code class=\"language-text\">Utf8GraphQLReader</code> to use <code class=\"language-text\">ReadOnlySequence&lt;byte&gt;</code> instead of <code class=\"language-text\">ReadOnlySpan&lt;byte&gt;</code> in order to make this even better work with the Pipeline API. Apart from that we will optimize the syntax tree to be able to work with raw bytes instead of strings. At the moment scalar like String, Int, Float and Enum are parsed as string representation like with the original node parser. The scalar type parses then the string into the native type. The same goes for the new UTF-8 request parser. This is unnecessary with the <code class=\"language-text\">Utf8Parser</code> and <code class=\"language-text\">Utf8Formater</code>. We will change the AST to instead have the raw bytes. The current <code class=\"language-text\">Value</code> property will still be there but only for compatibility with tools that use the current version of the AST. The new scalar types will have access to a <code class=\"language-text\">ReadOnlySpan&lt;byte&gt;</code> and can decide how to efficiently parse literals.</p>\n<p>If you want to get into contact with us head over to our <a href=\"https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTBkZjNjZWIzMmNlZjQ5MDQyNDNjMmY3NzYzZjgyYTVmZDU2YjVmNDlhNjNlNTk2ZWRiYzIxMTkwYzA4ODA5Yzg\">slack channel</a> and join our community.</p>\n<table>\n<thead>\n<tr>\n<th><a href=\"https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTBkZjNjZWIzMmNlZjQ5MDQyNDNjMmY3NzYzZjgyYTVmZDU2YjVmNDlhNjNlNTk2ZWRiYzIxMTkwYzA4ODA5Yzg\">HotChocolate Slack Channel</a></th>\n<th><a href=\"https://hotchocolate.io\">Hot Chocolate Documentation</a></th>\n<th><a href=\"https://github.com/ChilliCream/hotchocolate\">Hot Chocolate on GitHub</a></th>\n</tr>\n</thead>\n<tbody>\n</tbody>\n</table>","frontmatter":{"author":"Michael Staib","date":"August 14, 2019","path":"/blog/2019/08/14/hot-chocolate-10.0.0","title":"GraphQL - Hot Chocolate 10.0.0"}}},"pageContext":{}}}